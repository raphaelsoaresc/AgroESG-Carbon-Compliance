version: 2

sources:
  - name: raw_data  # Nome interno que usaremos no dbt: {{ source('raw_data', 'tabela') }}
    project: "{{ env_var('GCP_PROJECT_ID') }}" # Pega do .env
    dataset: agro_esg_raw # O dataset que as DAGs e Scripts populam
    
    tables:
      - name: sigef_history
        description: "Dados brutos das propriedades rurais vindos do SIGEF."
        columns:
          - name: file_hash
            description: "Hash MD5 do arquivo original para controle de idempotência."

      - name: ibama_history
        description: "Lista bruta de áreas embargadas pelo IBAMA."
        columns:
          - name: file_hash
            description: "Hash MD5 do arquivo original para controle de idempotência."

      - name: ibge_biomes
        description: "Dados espaciais dos Biomas Brasileiros (IBGE - Escala 1:250.000)."
        columns:
          - name: file_hash
            description: "Hash MD5 do arquivo original (Shapefile/Zip)."
          - name: wkt_geometry
            description: "Geometria do bioma em formato WKT (Texto), convertida para EPSG:4326."

      - name: funai_terras_indigenas  
        description: "Dados espaciais das Terras Indígenas (FUNAI) em diversas fases de homologação."
        columns:
          - name: file_hash
            description: "Hash MD5 do arquivo original."
          - name: geom
            description: "Geometria em WKT vinda do DuckDB (EPSG:4326)."

      - name: incra_quilombolas
        description: "Dados espaciais dos Territórios Quilombolas (INCRA)."
        columns:
          - name: file_hash
            description: "Hash MD5 do arquivo original."
          - name: geom
            description: "Geometria em WKT vinda do DuckDB (EPSG:4326)."

      - name: ana_app_zones
        description: "Zonas de APP geradas via DuckDB a partir da Base Hidrográfica da ANA (BHO Nível 07)."
        columns:
          - name: wkt_geom_app
            description: "Geometria do polígono da APP em formato WKT (EPSG:4326)."
          - name: river_order
            description: "Ordem de Strahler do trecho do rio."

      - name: ibge_bc250_app_zones
        description: "Zonas de APP de massas d'água (lagos/represas) vindas da BC250 do IBGE."

      - name: car_area_imovel_geometria
        description: "Spatial data of rural properties (CAR) containing the geometry and main status."
        columns:
          - name: wkt_geom
            description: "Geometry in WKT format (EPSG:4326) generated by DuckDB."
          - name: file_hash
            description: "MD5 hash of the original ZIP file."

      - name: car_metadados_proprietarios
        description: "Metadata regarding property owners and registration dates."
      
      - name: car_temas_ambientais
        description: "APP, Reserva Legal, etc (CSV)."

      - name: car_sobreposicao
        description: "Sobreposição com TIs e UCs (CSV)."
      
      - name: mte_slave_labor_history
        description: "Cadastro de Empregadores que tenham submetido trabalhadores a condições análogas à de escravo (Lista Suja do MTE)."
        columns:
          - name: file_hash
            description: "Hash MD5 do arquivo original para controle de idempotência."
          - name: cnpjcpf
            description: "Identificador único do infrator (CPF ou CNPJ)."
          - name: estabelecimento
            description: "String bruta contendo nome da propriedade, endereço e localidade."